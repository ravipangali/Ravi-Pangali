(function($){'use strict';let relatedModalCounter=0;function checkIfInIframe(){return window.top !==window.self;}function dismissModal(){if(checkIfInIframe()){const parentWindow=window.parent;parentWindow.dismissModal();return;}$('.related-modal-' + relatedModalCounter).modal('hide');relatedModalCounter-=1;}function showModal(title,body,e){if(checkIfInIframe()){const parentWindow=window.parent;parentWindow.showModal(title,body,e);return;}relatedModalCounter+=1;$.showModal({title:title,body:body,backdrop:false,modalDialogClass:"modal-dialog-centered modal-lg",modalClass:"fade modal-wide related-modal-" + relatedModalCounter,onDispose:function(){var lastModal=$("div[class*='related-modal-']").last();if(lastModal){lastModal.focus();}}});const modalEl=$("div[class*='related-modal-']");const iframeEl=modalEl.find('#related-modal-iframe');if(e.data.lookup===true){iframeEl.on('load',function(){const iframeObj=$(this).get(0);const iframeWindow=iframeObj.contentWindow;iframeWindow.opener=window;});}}function dismissRelatedLookupModal(win,chosenId){const windowName=win.name;const widgetName=windowName.replace(/^(change|add|delete|lookup)_/,'');let widgetEl;if(checkIfInIframe){const secondLastIframe=$('iframe.related-iframe',win.parent.document).eq(-2);let documentContext;if(secondLastIframe.length){documentContext=secondLastIframe.contents();}else{documentContext=$(win.parent.document);}widgetEl=documentContext.find('#' + widgetName);}else{widgetEl=$('#' + widgetName);}const widgetVal=widgetEl.val();if(widgetEl.hasClass('vManyToManyRawIdAdminField')&& Boolean(widgetVal)){widgetEl.val(widgetVal + ',' + chosenId);}else{widgetEl.val(chosenId);}dismissModal();}window.dismissRelatedObjectModal=dismissModal;window.dismissRelatedLookupPopup=dismissRelatedLookupModal;window.showModal=showModal;function presentRelatedObjectModal(e){let linkEl=$(this);let href=(linkEl.attr('href')|| '');if(href===''){return;}e.preventDefault();e.stopImmediatePropagation();linkEl.blur();let iframeName=linkEl.attr('id');let iframeSrc=href;const modalTitle=linkEl.attr('title');if(e.data.lookup !==true){let iframeSrcRandom=String(Math.round(Math.random()* 999999));if(iframeSrc.indexOf('?')===-1){iframeSrc +='?_modal=' + iframeSrcRandom;}else{iframeSrc +='&_modal=' + iframeSrcRandom;}}if(iframeSrc.indexOf('_popup=1')===-1){if(iframeSrc.indexOf('?')===-1){iframeSrc +='?_popup=1';}else{iframeSrc +='&_popup=1';}}let iframeHTML='<iframe id="related-modal-iframe" name="' + iframeName + '" src="' + iframeSrc + '" frameBorder="0" class="related-iframe"></iframe>';let iframeInternalModalClass='related-modal';if(window.top !==window.self){iframeInternalModalClass +=' related-modal__nested';}showModal(modalTitle,iframeHTML,e);return false;}function presentRelatedObjectModalOnClickOn(selector,lookup){let el=$(selector);el.removeAttr('onclick');el.unbind('click');el.click({lookup:lookup},presentRelatedObjectModal);}function init(){presentRelatedObjectModalOnClickOn('a.related-widget-wrapper-link',false);presentRelatedObjectModalOnClickOn('a.related-lookup',true);presentRelatedObjectModalOnClickOn('a.dynamic_raw_id-related-lookup',true);}$(document).ready(function(){init()});django.jQuery(document).on('formset:added',init);})(jQuery);